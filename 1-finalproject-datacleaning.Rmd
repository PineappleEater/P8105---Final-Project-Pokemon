---
title: "Data Source and Data Cleaning Process"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_float: true
    code_folding: show
    theme: cosmo
    self_contained: true
knit: (function(input, ...) {
    rmarkdown::render(
      input,
      output_dir = "reports"
    )
  })
---
```{r}
library(rvest)
library(tidyverse)
library(janitor)
```


### Data Source  
The data used in this project were scraped from pokemondb.net, a resource that maintains one of the most complete collections of Pokémon information to date, encompassing all nine generations (1,025 Pokémon species including alternate forms).  
The dataset includes variables such as base statistics, physical dimensions (height and weight), and type attributes.  
A portion of the metadata is sourced from the Veekun database, with additional details compiled by community contributors based on in-game data.

I used `read_html()`, `html_table()`, and `as_tibble()` converted web page data into a tabular format.  
```{r}
raw_state_df <- read_html("data/raw-data/Pokemon.html") |>
  html_table()

raw_wh_df <- read_html("data/raw-data/Pokemon by height and weight.html") |>
  html_table()

raw_evolved_df <- read_html("data/raw-data/Pokemon fully evolved.html") |>
  html_table()
```

```{r}
pokemon_state_df <- as_tibble(raw_state_df[[1]]) |>
  janitor::clean_names()

names(pokemon_state_df)

pokemon_df <- as_tibble(raw_wh_df[[1]]) |>
  janitor::clean_names() |>
  right_join(pokemon_state_df, by = c("name", "type", "number")) |>
  mutate(type_split = str_extract_all(type, "[A-Z][a-z]+")) |>
  mutate(
    type_1 = map_chr(type_split, ~ .x[1] %||% NA_character_),
    type_2 = map_chr(type_split, ~ .x[2] %||% NA_character_)
  ) |>
  rename(
    dex = number
  ) |>
  mutate(
    weight_kgs = ifelse(name == "EternatusEternamax", 9999.9, weight_kgs),
    height_m = ifelse(name == "EternatusEternamax", 999.9, height_m),
    bmi = ifelse(name == "EternatusEternamax", round(9999.9 / (999.9^2), 1), bmi)
  ) |>
  select(
    dex, name, type_1, type_2,
    total, hp, attack, defense, sp_atk, sp_def, speed,
    height_m, weight_kgs, bmi,
    -height_ft, -weight_lbs, -type_split, -type
  )

# Export complete dataset
write_csv(pokemon_df, "data/pokemon_data.csv")
```

Note: For "Eternamax" Eternatus, no official height or weight data exists. Based on its in-game appearance and the way it is portrayed in the anime—as a colossal, rift-like dragon composed of red energy, fractures, and crystalline lines—I set its size to 999.9 meters tall and 9999.9 kilograms in weight. The resulting BMI is effectively zero, perfectly matching the idea of a non-physical energy entity. This also aligns with how the anime almost never shows its full body, only fragmented sections of its form.

```{r}
# About Legendary of Pokémon:
pokemon_legend <- pokemon_df |>
  filter(dex %in% c(
    144, 145, 146, 150,
    243, 244, 245, 249, 250,
    377, 378, 379, 380, 381, 382, 383, 384,
    480, 481, 482, 483, 484, 485, 486, 487, 488,
    638, 639, 640, 641, 642, 643, 644, 645, 646,
    716, 717, 718,
    772, 773, 785, 786, 787, 788, 789, 790, 791, 792,
    800, 888, 889, 890, 891, 892, 894, 895, 896, 897, 898, 905,
    1001, 1002, 1003, 1004, 1007, 1008, 1014, 1015, 1016, 1017, 1024
  ))


# About Mythical of Pokémon:
pokemon_myth <- pokemon_df |>
  filter(dex %in% c(
    151,
    251,
    385, 386,
    489, 490, 491, 492, 493,
    494, 647, 684, 689,
    719, 720, 721,
    801, 802, 807, 808, 809,
    893,
    1025
  ))


# About Paradox of Pokémon:
pokemon_para <- pokemon_df |>
  filter(dex %in% c(984:995, 1005:1010, 1020:1023))


# About Ultra Beast of Pokémon:
pokemon_ub <- pokemon_df |>
  filter(dex %in% c(793:799, 803:806))
```

```{r}
# About Final form list of Pokémon:
pokemon_evolved_n <- raw_evolved_df[[1]] |>
  as_tibble(.name_repair = "unique") |>
  janitor::clean_names() |>
  rename(dex = number) |>
  select(dex)

pokemon_evolved_df <- pokemon_df |>
  filter(dex %in% pokemon_evolved_n$dex)
legend_evolved_df <- pokemon_legend |>
  filter(dex %in% pokemon_evolved_n$dex)
myth_evolved_df <- pokemon_myth |>
  filter(dex %in% pokemon_evolved_n$dex)

# Export final evolution dataset (primary dataset for all downstream analysis)
write_csv(pokemon_evolved_df, "data/pokemon_data_final_evolutions.csv")
```   

---

## Cleaned Datasets Summary

### Exported CSV Files

| File Name | Pokémon Count | Description | Recommended Use |
|-----------|---------------|-------------|----------------|
| `pokemon_data.csv` | 1,219 | Complete dataset (all evolution stages) | Reference, comprehensive analysis |
| `pokemon_data_final_evolutions.csv` | 743 | **Final evolutions only** | Statistical analysis & ML modeling |


---

### In-Memory R Objects

| Object Name | Count | Type | Description |
|-------------|-------|------|-------------|
| **`pokemon_df`** | 1,219 | Primary | Complete dataset (all evolution stages) |
| **`pokemon_evolved_df`** | 743 | Primary | Final evolutions only (recommended) |
| `pokemon_legend` | varies | Subset | Legendary Pokemon (all stages) |
| `pokemon_myth` | varies | Subset | Mythical Pokemon (all stages) |
| `pokemon_para` | varies | Subset | Paradox Pokemon (all stages) |
| `pokemon_ub` | varies | Subset | Ultra Beast Pokemon (all stages) |
| `pokemon_evolved_n` | 743 | Lookup | Dex numbers of final evolution forms |
| `legend_evolved_df` | varies | Auxiliary | Final evolution Legendary (in-memory) |
| `myth_evolved_df` | varies | Auxiliary | Final evolution Mythical (in-memory) |

---

## Data Dictionary

All datasets share the same **14-variable tidy structure**, organized into four categories:

### Identification Variables

| Variable | Type | Description |
|----------|------|-------------|
| `dex` | Integer | National Pokedex number (unique identifier) |
| `name` | Character | Official English species name |

### Type Classification

| Variable | Type | Description |
|----------|------|-------------|
| `type_1` | Character | Primary elemental type (Fire, Water, Grass, etc.) |
| `type_2` | Character | Secondary type (NA if monotype) |

### Battle Statistics (Base Stats)

| Variable | Type | Typical Range | Description |
|----------|------|---------------|-------------|
| `total` | Integer | 180-1125 | Base Stat Total (BST) - sum of all 6 stats |
| `hp` | Integer | 1-255 | Hit Points - damage capacity before fainting |
| `attack` | Integer | 5-190 | Physical move power |
| `defense` | Integer | 5-250 | Physical damage reduction |
| `sp_atk` | Integer | 10-194 | Special move power |
| `sp_def` | Integer | 20-250 | Special damage reduction |
| `speed` | Integer | 5-200 | Turn order determinant (higher = faster) |

### Physical Attributes

| Variable | Type | Units | Description |
|----------|------|-------|-------------|
| `height_m` | Numeric | meters | Official Pokedex height |
| `weight_kgs` | Numeric | kilograms | Official Pokedex weight |
| `bmi` | Numeric | kg/m^2 | Body Mass Index: weight / (height^2) |

---

